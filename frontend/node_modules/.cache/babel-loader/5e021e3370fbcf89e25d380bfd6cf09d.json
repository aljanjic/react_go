{"ast":null,"code":"import _defineProperty from\"/home/aljani/projects/last_try/source-front/source-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/home/aljani/projects/last_try/source-front/source-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _classCallCheck from\"/home/aljani/projects/last_try/source-front/source-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/aljani/projects/last_try/source-front/source-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"/home/aljani/projects/last_try/source-front/source-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/home/aljani/projects/last_try/source-front/source-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/aljani/projects/last_try/source-front/source-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component,Fragment}from\"react\";import{Link}from\"react-router-dom\";import\"./EditMovie.css\";import Input from\"./form-components/Input\";import Select from\"./form-components/Select\";import TextArea from\"./form-components/TextArea\";import Alert from\"./ui-components/Alert\";import{confirmAlert}from\"react-confirm-alert\";import\"react-confirm-alert/src/react-confirm-alert.css\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";var EditMovie=/*#__PURE__*/function(_Component){_inherits(EditMovie,_Component);var _super=_createSuper(EditMovie);function EditMovie(props){var _this;_classCallCheck(this,EditMovie);_this=_super.call(this,props);_this.handleSubmit=function(evt){evt.preventDefault();// do validation\nvar errors=[];if(_this.state.movie.title===\"\"){errors.push(\"title\");}_this.setState({errors:errors});if(errors.length>0){return false;}// we passed, so post info\nvar data=new FormData(evt.target);var payload=Object.fromEntries(data.entries());var myHeaders=new Headers();myHeaders.append(\"Content-Type\",\"application/json\");myHeaders.append(\"Authorization\",\"Bearer \"+_this.props.jwt);var requestOptions={method:\"POST\",body:JSON.stringify(payload),headers:myHeaders};fetch(\"\".concat(process.env.REACT_APP_API_URL,\"/v1/admin/editmovie\"),requestOptions).then(function(response){return response.json();}).then(function(data){if(data.error){_this.setState({alert:{type:\"alert-danger\",message:data.error.message}});}else{_this.props.history.push({pathname:\"/admin\"});}});};_this.handleChange=function(evt){var value=evt.target.value;var name=evt.target.name;_this.setState(function(prevState){return{movie:_objectSpread(_objectSpread({},prevState.movie),{},_defineProperty({},name,value))};});};_this.confirmDelete=function(e){console.log(\"would delete id\",_this.state.movie.id);confirmAlert({title:\"Delete Movie?\",message:\"Are you sure?\",buttons:[{label:\"Yes\",onClick:function onClick(){// delete the movie\nvar myHeaders=new Headers();myHeaders.append(\"Content-Type\",\"application/json\");myHeaders.append(\"Authorization\",\"Bearer \"+_this.props.jwt);fetch(\"\".concat(process.env.REACT_APP_API_URL,\"/v1/admin/deletemovie/\")+_this.state.movie.id,{method:\"GET\",headers:myHeaders}).then(function(response){return response.json;}).then(function(data){if(data.error){_this.setState({alert:{type:\"alert-danger\",message:data.error.message}});}else{_this.setState({alert:{type:\"alert-success\",message:\"Movie deleted!\"}});_this.props.history.push({pathname:\"/admin\"});}});}},{label:\"No\",onClick:function onClick(){}}]});};_this.state={movie:{id:0,title:\"\",release_date:\"\",runtime:\"\",mpaa_rating:\"\",rating:\"\",description:\"\"},mpaaOptions:[{id:\"G\",value:\"G\"},{id:\"PG\",value:\"PG\"},{id:\"PG13\",value:\"PG13\"},{id:\"R\",value:\"R\"},{id:\"NC17\",value:\"NC17\"}],isLoaded:false,error:null,errors:[],alert:{type:\"d-none\",message:\"\"}};_this.handleChange=_this.handleChange.bind(_assertThisInitialized(_this));_this.handleSubmit=_this.handleSubmit.bind(_assertThisInitialized(_this));return _this;}_createClass(EditMovie,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;if(this.props.jwt===\"\"){this.props.history.push({pathname:\"/login\"});return;}var id=this.props.match.params.id;if(id>0){fetch(\"\".concat(process.env.REACT_APP_API_URL,\"/v1/movie/\")+id).then(function(response){if(response.status!==\"200\"){var err=Error;err.message=\"Invalid response code: \"+response.status;_this2.setState({error:err});}return response.json();}).then(function(json){var releaseDate=new Date(json.movie.release_date);_this2.setState({movie:{id:id,title:json.movie.title,release_date:releaseDate.toISOString().split(\"T\")[0],runtime:json.movie.runtime,mpaa_rating:json.movie.mpaa_rating,rating:json.movie.rating,description:json.movie.description},isLoaded:true},function(error){_this2.setState({isLoaded:true,error:error});});});}else{this.setState({isLoaded:true});}}},{key:\"hasError\",value:// *** add this\nfunction hasError(key){return this.state.errors.indexOf(key)!==-1;}},{key:\"render\",value:function render(){var _this3=this;var _this$state=this.state,movie=_this$state.movie,isLoaded=_this$state.isLoaded,error=_this$state.error;if(error){return/*#__PURE__*/_jsxs(\"div\",{children:[\"Error: \",error.message]});}else if(!isLoaded){return/*#__PURE__*/_jsx(\"p\",{children:\"Loading...\"});}else{return/*#__PURE__*/_jsxs(Fragment,{children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Add/Edit Movie\"}),/*#__PURE__*/_jsx(Alert,{alertType:this.state.alert.type,alertMessage:this.state.alert.message}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:this.handleSubmit,children:[/*#__PURE__*/_jsx(\"input\",{type:\"hidden\",name:\"id\",id:\"id\",value:movie.id,onChange:this.handleChange}),/*#__PURE__*/_jsx(Input,{title:\"Title\",className:this.hasError(\"title\")?\"is-invalid\":\"\",type:\"text\",name:\"title\",value:movie.title,handleChange:this.handleChange,errorDiv:this.hasError(\"title\")?\"text-danger\":\"d-none\",errorMsg:\"Please enter a title\"}),/*#__PURE__*/_jsx(Input,{title:\"Release Date\",type:\"date\",name:\"release_date\",value:movie.release_date,handleChange:this.handleChange}),/*#__PURE__*/_jsx(Input,{title:\"Runtime\",type:\"text\",name:\"runtime\",value:movie.runtime,handleChange:this.handleChange}),/*#__PURE__*/_jsx(Select,{title:\"MPAA Rating\",name:\"mpaa_rating\",options:this.state.mpaaOptions,value:movie.mpaa_rating,handleChange:this.handleChange,placeholder:\"Choose...\"}),/*#__PURE__*/_jsx(Input,{title:\"Rating\",type:\"text\",name:\"rating\",value:movie.rating,handleChange:this.handleChange}),/*#__PURE__*/_jsx(TextArea,{title:\"Description\",name:\"description\",value:movie.description,rows:\"3\",handleChange:this.handleChange}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-primary\",children:\"Save\"}),/*#__PURE__*/_jsx(Link,{to:\"/admin\",className:\"btn btn-warning ms-1\",children:\"Cancel\"}),movie.id>0&&/*#__PURE__*/_jsx(\"a\",{href:\"#!\",onClick:function onClick(){return _this3.confirmDelete();},className:\"btn btn-danger ms-1\",children:\"Delete\"})]})]});}}}]);return EditMovie;}(Component);export{EditMovie as default};","map":{"version":3,"sources":["/home/aljani/projects/last_try/source-front/source-front/src/components/EditMovie.js"],"names":["React","Component","Fragment","Link","Input","Select","TextArea","Alert","confirmAlert","EditMovie","props","handleSubmit","evt","preventDefault","errors","state","movie","title","push","setState","length","data","FormData","target","payload","Object","fromEntries","entries","myHeaders","Headers","append","jwt","requestOptions","method","body","JSON","stringify","headers","fetch","process","env","REACT_APP_API_URL","then","response","json","error","alert","type","message","history","pathname","handleChange","value","name","prevState","confirmDelete","e","console","log","id","buttons","label","onClick","release_date","runtime","mpaa_rating","rating","description","mpaaOptions","isLoaded","bind","match","params","status","err","Error","releaseDate","Date","toISOString","split","key","indexOf","hasError"],"mappings":"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","sourcesContent":["import React, { Component, Fragment } from \"react\";\nimport { Link } from \"react-router-dom\";\nimport \"./EditMovie.css\";\nimport Input from \"./form-components/Input\";\nimport Select from \"./form-components/Select\";\nimport TextArea from \"./form-components/TextArea\";\nimport Alert from \"./ui-components/Alert\";\nimport { confirmAlert } from \"react-confirm-alert\";\nimport \"react-confirm-alert/src/react-confirm-alert.css\";\n\nexport default class EditMovie extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      movie: {\n        id: 0,\n        title: \"\",\n        release_date: \"\",\n        runtime: \"\",\n        mpaa_rating: \"\",\n        rating: \"\",\n        description: \"\",\n      },\n      mpaaOptions: [\n        { id: \"G\", value: \"G\" },\n        { id: \"PG\", value: \"PG\" },\n        { id: \"PG13\", value: \"PG13\" },\n        { id: \"R\", value: \"R\" },\n        { id: \"NC17\", value: \"NC17\" },\n      ],\n      isLoaded: false,\n      error: null,\n      errors: [],\n      alert: {\n        type: \"d-none\",\n        message: \"\",\n      },\n    };\n    this.handleChange = this.handleChange.bind(this);\n    this.handleSubmit = this.handleSubmit.bind(this);\n  }\n\n  componentDidMount() {\n    if (this.props.jwt === \"\") {\n      this.props.history.push({\n        pathname: \"/login\",\n      });\n      return;\n    }\n\n    const id = this.props.match.params.id;\n    if (id > 0) {\n      fetch(`${process.env.REACT_APP_API_URL}/v1/movie/` + id)\n        .then((response) => {\n          if (response.status !== \"200\") {\n            let err = Error;\n            err.message = \"Invalid response code: \" + response.status;\n            this.setState({ error: err });\n          }\n          return response.json();\n        })\n        .then((json) => {\n          const releaseDate = new Date(json.movie.release_date);\n\n          this.setState(\n            {\n              movie: {\n                id: id,\n                title: json.movie.title,\n                release_date: releaseDate.toISOString().split(\"T\")[0],\n                runtime: json.movie.runtime,\n                mpaa_rating: json.movie.mpaa_rating,\n                rating: json.movie.rating,\n                description: json.movie.description,\n              },\n              isLoaded: true,\n            },\n            (error) => {\n              this.setState({\n                isLoaded: true,\n                error,\n              });\n            }\n          );\n        });\n    } else {\n      this.setState({ isLoaded: true });\n    }\n  }\n\n  handleSubmit = (evt) => {\n    evt.preventDefault();\n    // do validation\n    let errors = [];\n    if (this.state.movie.title === \"\") {\n      errors.push(\"title\");\n    }\n\n    this.setState({ errors: errors });\n\n    if (errors.length > 0) {\n      return false;\n    }\n\n    // we passed, so post info\n    const data = new FormData(evt.target);\n    const payload = Object.fromEntries(data.entries());\n    const myHeaders = new Headers();\n    myHeaders.append(\"Content-Type\", \"application/json\");\n    myHeaders.append(\"Authorization\", \"Bearer \" + this.props.jwt);\n\n    const requestOptions = {\n      method: \"POST\",\n      body: JSON.stringify(payload),\n      headers: myHeaders,\n    };\n    fetch(`${process.env.REACT_APP_API_URL}/v1/admin/editmovie`, requestOptions)\n      .then((response) => response.json())\n      .then((data) => {\n        if (data.error) {\n          this.setState({\n            alert: { type: \"alert-danger\", message: data.error.message },\n          });\n        } else {\n          this.props.history.push({\n            pathname: \"/admin\",\n          });\n        }\n      });\n  };\n\n  handleChange = (evt) => {\n    let value = evt.target.value;\n    let name = evt.target.name;\n    this.setState((prevState) => ({\n      movie: {\n        ...prevState.movie,\n        [name]: value,\n      },\n    }));\n  };\n\n  // *** add this\n  hasError(key) {\n    return this.state.errors.indexOf(key) !== -1;\n  }\n\n  confirmDelete = (e) => {\n    console.log(\"would delete id\", this.state.movie.id);\n\n    confirmAlert({\n      title: \"Delete Movie?\",\n      message: \"Are you sure?\",\n      buttons: [\n        {\n          label: \"Yes\",\n          onClick: () => {\n            // delete the movie\n            const myHeaders = new Headers();\n            myHeaders.append(\"Content-Type\", \"application/json\");\n            myHeaders.append(\"Authorization\", \"Bearer \" + this.props.jwt);\n\n            fetch(\n              `${process.env.REACT_APP_API_URL}/v1/admin/deletemovie/` +\n                this.state.movie.id,\n              {\n                method: \"GET\",\n                headers: myHeaders,\n              }\n            )\n              .then((response) => response.json)\n              .then((data) => {\n                if (data.error) {\n                  this.setState({\n                    alert: {\n                      type: \"alert-danger\",\n                      message: data.error.message,\n                    },\n                  });\n                } else {\n                  this.setState({\n                    alert: { type: \"alert-success\", message: \"Movie deleted!\" },\n                  });\n                  this.props.history.push({\n                    pathname: \"/admin\",\n                  });\n                }\n              });\n          },\n        },\n        {\n          label: \"No\",\n          onClick: () => {},\n        },\n      ],\n    });\n  };\n\n  render() {\n    let { movie, isLoaded, error } = this.state;\n    if (error) {\n      return <div>Error: {error.message}</div>;\n    } else if (!isLoaded) {\n      return <p>Loading...</p>;\n    } else {\n      return (\n        <Fragment>\n          <h2>Add/Edit Movie</h2>\n          <Alert\n            alertType={this.state.alert.type}\n            alertMessage={this.state.alert.message}\n          />\n          <hr />\n          <form onSubmit={this.handleSubmit}>\n            <input\n              type=\"hidden\"\n              name=\"id\"\n              id=\"id\"\n              value={movie.id}\n              onChange={this.handleChange}\n            />\n\n            <Input\n              title={\"Title\"}\n              className={this.hasError(\"title\") ? \"is-invalid\" : \"\"}\n              type={\"text\"}\n              name={\"title\"}\n              value={movie.title}\n              handleChange={this.handleChange}\n              errorDiv={this.hasError(\"title\") ? \"text-danger\" : \"d-none\"}\n              errorMsg={\"Please enter a title\"}\n            />\n\n            <Input\n              title={\"Release Date\"}\n              type={\"date\"}\n              name={\"release_date\"}\n              value={movie.release_date}\n              handleChange={this.handleChange}\n            />\n\n            <Input\n              title={\"Runtime\"}\n              type={\"text\"}\n              name={\"runtime\"}\n              value={movie.runtime}\n              handleChange={this.handleChange}\n            />\n\n            <Select\n              title={\"MPAA Rating\"}\n              name={\"mpaa_rating\"}\n              options={this.state.mpaaOptions}\n              value={movie.mpaa_rating}\n              handleChange={this.handleChange}\n              placeholder=\"Choose...\"\n            />\n\n            <Input\n              title={\"Rating\"}\n              type={\"text\"}\n              name={\"rating\"}\n              value={movie.rating}\n              handleChange={this.handleChange}\n            />\n\n            <TextArea\n              title={\"Description\"}\n              name={\"description\"}\n              value={movie.description}\n              rows={\"3\"}\n              handleChange={this.handleChange}\n            />\n\n            <hr />\n\n            <button className=\"btn btn-primary\">Save</button>\n            <Link to=\"/admin\" className=\"btn btn-warning ms-1\">\n              Cancel\n            </Link>\n            {movie.id > 0 && (\n              <a\n                href=\"#!\"\n                onClick={() => this.confirmDelete()}\n                className=\"btn btn-danger ms-1\"\n              >\n                Delete\n              </a>\n            )}\n          </form>\n        </Fragment>\n      );\n    }\n  }\n}\n"]},"metadata":{},"sourceType":"module"}